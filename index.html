<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temp Mail Box</title>

<style>
body{
  margin:0;
  padding:20px;
  font-family:Arial;
  background:linear-gradient(135deg,#4c1d95,#6d28d9,#7c3aed);
  color:white;
}
.container{
  max-width:700px;
  margin:auto;
  background:rgba(255,255,255,.12);
  padding:20px;
  border-radius:14px;
}
button,input{
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:bold;
}
.generate{width:100%;background:#0ea5e9;color:white;}
.check{width:100%;margin-top:10px;background:#f59e0b;color:white;}
.email-box{display:flex;gap:8px;margin-top:10px;}
.email-box input{flex:1;background:white;color:black;}
.copy{background:#22c55e;color:white;}

.inbox{
  margin-top:15px;
  background:#0b1220;
  border-radius:10px;
  padding:10px;
  min-height:180px;
}
.mail{
  background:#1e293b;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
}
.code{
  background:#22c55e;
  color:black;
  padding:3px 8px;
  border-radius:6px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

  <button class="generate" onclick="generateEmail()">‚ö° Generate Email</button>

  <div class="email-box">
    <input id="emailField" readonly placeholder="Generated email">
    <button class="copy" onclick="copyEmail()">COPY</button>
  </div>

  <button class="check" onclick="checkInbox()">üì• CHECK INBOX</button>

  <div class="inbox" id="inbox">
    Waiting for messages...
  </div>

</div>

<script>
let activeEmail = null;

const domains = ["1secmail.com","1secmail.net","1secmail.org"];

function rand(len){
  const chars="abcdefghijklmnopqrstuvwxyz0123456789";
  let r="";
  for(let i=0;i<len;i++)
    r+=chars[Math.floor(Math.random()*chars.length)];
  return r;
}

function generateEmail(){
  const login = rand(10);
  const domain = domains[Math.floor(Math.random()*domains.length)];
  activeEmail = `${login}@${domain}`;

  document.getElementById("emailField").value = activeEmail;
  document.getElementById("inbox").innerHTML = "No messages yet.";
}

function copyEmail(){
  const f=document.getElementById("emailField");
  navigator.clipboard.writeText(f.value);
  alert("Copied!");
}

/* CHECK REAL INBOX */
async function checkInbox(){

  if(!activeEmail){
    alert("Generate email first.");
    return;
  }

  const [login,domain]=activeEmail.split("@");

  const box=document.getElementById("inbox");
  box.innerHTML="Checking inbox...";

  try{
    // 1Ô∏è‚É£ get messages list
    const listRes = await fetch(
      `https://www.1secmail.com/api/v1/?action=getMessages&login=${login}&domain=${domain}`
    );

    const mails = await listRes.json();

    if(mails.length===0){
      box.innerHTML="No messages yet.";
      return;
    }

    box.innerHTML="";

    // 2Ô∏è‚É£ read each mail content
    for(const m of mails){

      const readRes = await fetch(
        `https://www.1secmail.com/api/v1/?action=readMessage&login=${login}&domain=${domain}&id=${m.id}`
      );

      const data = await readRes.json();

      // OTP detector (4-8 digit codes)
      const codeMatch =
        (data.body || "").match(/\b\d{4,8}\b/);

      const codeHTML = codeMatch
        ? `<br>OTP: <span class="code">${codeMatch[0]}</span>`
        : "";

      const div=document.createElement("div");
      div.className="mail";
      div.innerHTML = `
        <b>From:</b> ${data.from}<br>
        <b>Subject:</b> ${data.subject}<br>
        ${codeHTML}
      `;

      box.appendChild(div);
    }

  }catch(e){
    box.innerHTML = "‚ùå Failed to check inbox.";
    console.log(e);
  }
}
</script>

</body>
</html>
